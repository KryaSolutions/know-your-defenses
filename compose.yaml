services:
    backend:
        build:
            context: ./backend
            dockerfile: Dockerfile
        working_dir: /app
        ports:
            - "10300:10300"
        env_file:
            - ".env"
        restart: unless-stopped
        deploy:
            resources:
                limits:
                    cpus: "1.0"
                    memory: 1G
                reservations:
                    cpus: "0.5"
                    memory: 512M
        healthcheck:
            test: ["CMD-SHELL", "curl -f http://localhost:10300/api/health"]
            interval: 30s
            timeout: 5s
            retries: 1
            start_period: 10s

    frontend:
        build:
            context: ./frontend
            dockerfile: Dockerfile
        working_dir: /usr/share/nginx/html
        ports:
            - "10200:80"
        depends_on:
            - backend
        restart: on-failure
        deploy:
            resources:
                limits:
                    cpus: "0.5"
                    memory: 512M
                reservations:
                    cpus: "0.25"
                    memory: 256M
        healthcheck:
            test:
                [
                    "CMD-SHELL",
                    "wget --no-verbose --tries=1 --spider http://localhost || exit 1",
                ]
            interval: 30s
            timeout: 5s
            retries: 3
            start_period: 10s
